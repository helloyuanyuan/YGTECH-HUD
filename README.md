# YGTECH-HUD

## 系统要求

- **遥控器系统**: EdgeTX 2.11+ 或 3.0+
- **硬件**: 支持彩色触摸屏的 EdgeTX 遥控器(如 Radiomaster TX16S, Jumper T16, etc.)
- **遥测协议**: CRSF (Crossfire) 或兼容协议
- **显示器分辨率**: 建议 480x320 像素

## 安装说明

### 1. 文件结构

将项目文件复制到 SD 卡的对应目录:

```
SD_CARD/
├── SCRIPTS/
│   └── TOOLS/
│       ├── YGTECH-HUD.lua          # 主工具脚本
│       ├── YGTECH-HUD.txt          # 配置存储文件
│       └── home.png                # 原点图标(需自行准备)
└── WIDGETS/
    ├── YGTECH-HUD/
    │   └── main.lua                # HUD Widget
    └── YGTECH-MAP/
        └── main.lua                # 地图 Widget
```

### 2. 添加图标资源

您需要准备一个名为 `home.png` 的图标文件,放置在 `/SCRIPTS/TOOLS/` 目录下,用于表示原点位置。

### 3. EdgeTX 配置

#### 作为工具脚本使用:

1. 在遥控器上导航到 **SYSTEM** → **TOOLS**
2. 选择 `YGTECH-HUD.lua` 启动

#### 作为 Widget 使用:

1. 进入主屏幕编辑模式
2. 添加 Widget: 选择 `YGTECH-HUD` 或 `YGTECH-MAP`
3. 调整 Widget 大小和位置

## 使用指南

### 显示模式切换

程序支持三种显示模式,可通过触摸或按键切换:

1. **模式 0 - 全屏地图**
   - 显示飞行器在地图上的位置
   - 左下角小窗口显示姿态 HUD
   - 底部显示详细遥测数据

2. **模式 1 - 全屏 HUD**
   - 天地线、俯仰/横滚指示
   - 高度/速度刻度尺
   - 航向罗盘
   - 右下角小地图窗口

3. **模式 2 - 组合模式**
   - 左侧 HUD,右侧地图
   - 下方分区显示遥测数据

### 触摸手势操作

| 触摸区域 | 操作 | 功能 |
|---------|------|------|
| 左上角(返回图标) | 点击 | 退出脚本 |
| 右上角(菜单图标) | 点击 | 打开设置菜单 |
| 左下角(模式图标) | 点击 | 切换 HUD 尺寸 |
| 小地图窗口 | 点击 | 循环切换显示模式 |
| 地图中心 | 点击 | 手动刷新原点位置 |
| 右上角相机图标 | 点击 | 截屏 |

### 按键操作(物理按键)

- **[RTN]**: 退出脚本
- **[ENTER]**: 打开设置菜单
- **[DIAL]**: 切换显示模式
- **[SYS]**: 切换 HUD 尺寸

### 原点设定

- **自动设定**: GPS 卫星数 ≥6 时自动记录当前位置为原点
- **手动刷新**: 在地图模式下点击中心区域,满足卫星条件时更新原点
- 原点设定成功会有提示音和消息提示

### 设置菜单

在设置菜单中可以配置:
- SETUP1-4: 自定义开关选项
- 查看系统信息(内存、版本)

## 遥测数据说明

### GPS 数据

- **LAT/LON**: 经纬度坐标
- **Alt**: 海拔高度(米)
- **Sats**: GPS 卫星数量
- **Hdop**: 水平精度因子
- **Dist**: 距离原点的距离

### 姿态数据

- **Roll**: 横滚角 (-180° ~ +180°)
- **Pitch**: 俯仰角 (-90° ~ +90°)
- **Yaw**: 航向角 (0° ~ 360°)

### 电池信息

- **RxBt**: 接收机电池电压
- **Curr**: 电流消耗(安培)
- **Bat%**: 电池剩余百分比

### 速度数据

- **VSpd**: 垂直速度(米/秒)
- **GSpd**: 地面速度(千米/小时)

### 链路质量

- **TX/RX**: 发射/接收质量百分比
- **RT**: 遥测刷新率
- **TP**: 发射功率

## 技术细节

### CRSF 遥测协议支持

脚本支持 CRSF 自定义遥测数据解析:
- **Passthrough**: 单帧数据
- **Passthrough Array**: 多数据数组
- **Status Text**: 状态文本消息

主要解析 `0x5006` 数据包获取俯仰/横滚角度。

### 坐标计算

采用 Haversine 公式计算地球表面两点间的距离:

```lua
distance = 2R × arcsin(√(sin²(Δφ/2) + cos(φ1) × cos(φ2) × sin²(Δλ/2)))
```

其中:
- R = 地球半径 (6371 km)
- φ = 纬度
- λ = 经度

### 配置存储

用户设置保存在 `YGTECH-HUD.txt` 文件中,采用固定长度格式:
- 每个参数占用 10 字节
- 支持最多 20 个参数位
- 自动初始化默认配置

## 颜色主题

默认颜色方案(可在设置中修改):

```lua
STATUS_BAR = RGB(30,30,30)    -- 状态栏深灰
MAP_BG = RGB(6,93,13)         -- 地图背景深绿
HUD_SKY = RGB(0,136,200)      -- 天空蓝
HUD_GROUND = RGB(160,95,14)   -- 地面棕
FONT_COLOR = WHITE            -- 文字白色
```
